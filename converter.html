<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelæ–‡ä»¶è½¬æ¢ç³»ç»Ÿ - å¹¿å·ç¿”ç¿”ç‰©æµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .box {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            background: #f9f9f9;
        }

        .box h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .box-icon {
            font-size: 1.8em;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f0ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8e0ff;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .upload-text {
            color: #666;
            font-size: 1em;
            line-height: 1.6;
        }

        .upload-button {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .upload-button:hover {
            background: #764ba2;
        }

        input[type="file"] {
            display: none;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .download-area {
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .download-placeholder {
            color: #999;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .download-button {
            background: #28a745;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background 0.3s ease;
            display: none;
        }

        .download-button:hover {
            background: #218838;
        }

        .download-button.show {
            display: inline-block;
        }

        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .loader {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .loader.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            background: #f5f5f5;
            padding: 20px 40px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¦ Excel æ–‡ä»¶è½¬æ¢ç³»ç»Ÿ</h1>
            <p>MANIFEST æ ¼å¼è½¬æ¢ä¸ºä½å·æ´¾é€æ¨¡æ¿</p>
        </div>

        <div class="content">
            <!-- å·¦ä¾§ï¼šä¸Šä¼ åŒºåŸŸ -->
            <div class="box">
                <h2>
                    <span class="box-icon">ğŸ“¤</span>
                    æ­¥éª¤ 1ï¼šä¸Šä¼  A æ–‡ä»¶ (MANIFEST)
                </h2>

                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <p class="upload-text">
                        æ‹–æ‹½ MANIFEST æ ¼å¼çš„ Excel æ–‡ä»¶åˆ°æ­¤å¤„<br>
                        <strong>æˆ–</strong>
                    </p>
                    <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                        ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
                    </button>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" />
                </div>

                <div class="file-info" id="fileInfo"></div>
                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨å¤„ç†æ–‡ä»¶ï¼Œè¯·ç¨å€™...</p>
                </div>
                <div class="status" id="uploadStatus"></div>
            </div>

            <!-- å³ä¾§ï¼šä¸‹è½½åŒºåŸŸ -->
            <div class="box">
                <h2>
                    <span class="box-icon">ğŸ“¥</span>
                    æ­¥éª¤ 2ï¼šä¸‹è½½ B æ–‡ä»¶ (ä½å·æ¨¡æ¿)
                </h2>

                <div class="download-area">
                    <div class="download-placeholder" id="downloadPlaceholder">
                        â³ ç­‰å¾…æ–‡ä»¶ä¸Šä¼ å’Œè½¬æ¢...
                    </div>
                    <button class="download-button" id="downloadButton" onclick="downloadFile()">
                        â¬‡ï¸ ä¸‹è½½è½¬æ¢åçš„æ–‡ä»¶
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Â©2025 å¹¿å·ç¿”ç¿”ç‰©æµæœ‰é™å…¬å¸ | å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜</p>
        </div>
    </div>

    <script>
        let uploadedFile = null;
        let convertedData = null;

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadStatus = document.getElementById('uploadStatus');
        const fileInfo = document.getElementById('fileInfo');
        const loader = document.getElementById('loader');
        const downloadButton = document.getElementById('downloadButton');
        const downloadPlaceholder = document.getElementById('downloadPlaceholder');

        // æ‹–æ‹½äº‹ä»¶
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        // æ–‡ä»¶é€‰æ‹©
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            // éªŒè¯æ–‡ä»¶æ ¼å¼
            const validFormats = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                                 'application/vnd.ms-excel',
                                 'application/x-xls',
                                 'application/x-xlsx'];

            if (!validFormats.includes(file.type) && !file.name.match(/\.(xlsx|xls)$/i)) {
                showStatus('error', 'âŒ é”™è¯¯ï¼šåªæ”¯æŒ Excel æ–‡ä»¶ (.xlsx æˆ– .xls)ï¼Œè¯·é‡æ–°ä¸Šä¼ æˆ–è”ç³»ç®¡ç†å‘˜');
                return;
            }

            uploadedFile = file;
            showFileInfo(file);
            convertFile(file);
        }

        function showFileInfo(file) {
            const sizeInKB = (file.size / 1024).toFixed(2);
            const uploadDate = new Date().toLocaleString('zh-CN');
            fileInfo.innerHTML = `
                <strong>âœ“ æ–‡ä»¶å·²é€‰æ‹©</strong><br>
                æ–‡ä»¶å: ${file.name}<br>
                æ–‡ä»¶å¤§å°: ${sizeInKB} KB<br>
                é€‰æ‹©æ—¶é—´: ${uploadDate}
            `;
            fileInfo.classList.add('show');
        }

        function convertFile(file) {
            loader.classList.add('show');
            uploadStatus.classList.remove('show');

            // åˆ›å»º FormData
            const formData = new FormData();
            formData.append('file', file);

            // æ¨¡æ‹Ÿå‘é€åˆ°æœåŠ¡å™¨è¿›è¡Œè½¬æ¢
            fetch('/api/convert', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.blob();
            })
            .then(blob => {
                convertedData = blob;
                loader.classList.remove('show');
                showStatus('success', 'âœ“ æ–‡ä»¶è½¬æ¢æˆåŠŸï¼');
                downloadButton.classList.add('show');
                downloadPlaceholder.textContent = 'âœ“ è½¬æ¢å®Œæˆï¼Œå¯ä»¥ä¸‹è½½æ–‡ä»¶';
            })
            .catch(error => {
                loader.classList.remove('show');
                console.error('Conversion error:', error);
                showStatus('error', 'âŒ è½¬æ¢å¤±è´¥ï¼š' + error.message + 'ï¼Œè¯·é‡æ–°ä¸Šä¼ æˆ–è”ç³»ç®¡ç†å‘˜');
                downloadButton.classList.remove('show');
                downloadPlaceholder.textContent = 'â³ ç­‰å¾…æ–‡ä»¶ä¸Šä¼ å’Œè½¬æ¢...';
            });
        }

        function downloadFile() {
            if (!convertedData) {
                showStatus('error', 'âŒ æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶');
                return;
            }

            const url = window.URL.createObjectURL(convertedData);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Zuo-Chuan-Converted-' + new Date().getTime() + '.xlsx';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function showStatus(type, message) {
            uploadStatus.className = `status show ${type}`;
            uploadStatus.textContent = message;
        }
    </script>
</body>
</html>
